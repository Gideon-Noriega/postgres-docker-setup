# Production PostgreSQL Configuration

# Connection Settings
listen_addresses = '*'                    # Accept connections from any IP
port = 5432                               # Standard PostgreSQL port
max_connections = 200                     # Max concurrent connections

# Memory Settings
shared_buffers = 256MB                    # RAM for caching data pages (25% of available RAM)
effective_cache_size = 1GB                # OS cache size estimate for query planner
work_mem = 4MB                            # Memory per query operation (sort, hash)
maintenance_work_mem = 64MB               # Memory for maintenance operations

# Write-Ahead Logging (WAL)
wal_buffers = 16MB                        # Buffer size for WAL data
min_wal_size = 1GB                        # Minimum WAL file size to keep
max_wal_size = 4GB                        # Maximum WAL size before checkpoint
checkpoint_completion_target = 0.9        # Spread checkpoints over 90% of interval

# Performance Tuning
default_statistics_target = 100           # Detail level for query planner statistics
random_page_cost = 1.1                    # Cost of random disk access (lower for SSDs)
effective_io_concurrency = 200            # Expected concurrent I/O operations

# Parallel Processing
max_worker_processes = 8                  # Total background worker processes
max_parallel_workers = 8                  # Workers for parallel queries
max_parallel_workers_per_gather = 2       # Workers per parallel operation
max_parallel_maintenance_workers = 2      # Workers for maintenance tasks

# Logging Configuration
log_destination = 'stderr'                # Send logs to stderr
logging_collector = on                     # Enable log collection
log_directory = 'log'                      # Log file directory
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'  # Log file naming pattern
log_rotation_age = 1d                      # Rotate logs daily
log_rotation_size = 100MB                  # Rotate when file reaches 100MB
log_min_duration_statement = 1000          # Log queries taking >1 second
log_checkpoints = on                       # Log checkpoint activity
log_connections = on                       # Log connection events
log_disconnections = on                    # Log disconnection events
log_lock_waits = on                        # Log when queries wait for locks